# PhotoBlog 프로젝트 실행 가이드 (한국어)

## 📌 프로젝트 개요

이 프로젝트는 Django 기반의 사진 블로그 서버와 AI 기반 웰빙 분석 시스템입니다.

**주요 구성 요소:**
- Django REST API 서버
- 웹캠 기반 실시간 감정/활동 분석 (YOLOv5 + DeepFace)
- 소켓 서버 (바이너리 데이터 수신)
- Android 모바일 앱

---

## 🚀 빠른 실행 방법 (Windows)

### 방법 1: 배치 파일 사용 (가장 쉬움)

1. **초기 설정 (최초 1회만)**
   ```
   setup.bat 더블클릭
   ```
   - 가상환경 생성
   - 패키지 설치
   - 데이터베이스 설정

2. **Django 서버 실행**
   ```
   start_server.bat 더블클릭
   ```
   - 브라우저에서 http://127.0.0.1:8000 접속

3. **Wellbeing Analyzer 실행 (선택사항)**
   ```
   start_analyzer.bat 더블클릭
   ```
   - 웹캠 필요
   - 실시간 감정 분석 시작

---

### 방법 2: 수동 실행

#### 1단계: 가상환경 설정

**PowerShell에서:**
```powershell
# 프로젝트 폴더로 이동
cd C:\Users\thddl\PhotoBlog

# 가상환경 생성
python -m venv venv

# 가상환경 활성화
.\venv\Scripts\Activate.ps1

# 의존성 설치
pip install -r requirements.txt
```

#### 2단계: 데이터베이스 설정

```bash
# 마이그레이션 실행
python manage.py migrate

# 관리자 계정 생성 (선택사항)
python manage.py createsuperuser
```

#### 3단계: 서버 실행

```bash
# Django 서버 시작
python manage.py runserver

# 또는 특정 포트 지정
python manage.py runserver 8000
```

**접속 주소:**
- 메인 페이지: http://127.0.0.1:8000/
- 관리자 페이지: http://127.0.0.1:8000/admin/
- API: http://127.0.0.1:8000/api_root/

---

## 📋 실행 순서 요약

### 기본 실행 (Django 서버만)

```
1. setup.bat 실행 (최초 1회)
2. start_server.bat 실행
3. 브라우저에서 http://127.0.0.1:8000 접속
```

### 전체 시스템 실행

```
1. setup.bat 실행 (최초 1회)
2. start_server.bat 실행 (터미널 1)
3. start_analyzer.bat 실행 (터미널 2, 웹캠 필요)
```

---

## 🔍 코드 점검 결과

### ✅ 수정 완료된 사항

1. **settings.py 오타 수정**
   - `TIME_ZOME` → `TIME_ZONE` 수정
   - 중복된 설정 제거 (`DEFAULT_CHARSET`, `STATIC_URL`, `STATIC_ROOT`)

2. **프로젝트 구조 확인**
   - 모든 필수 파일 존재 확인
   - URL 라우팅 정상 확인
   - 모델 및 시리얼라이저 정상 확인

### 📝 생성된 파일

1. **requirements.txt** - Python 의존성 목록
2. **README.md** - 프로젝트 전체 가이드 (영문)
3. **실행가이드.md** - 한국어 실행 가이드 (이 파일)
4. **setup.bat** - 초기 설정 자동화 스크립트
5. **start_server.bat** - Django 서버 실행 스크립트
6. **start_analyzer.bat** - Wellbeing Analyzer 실행 스크립트

---

## 🎯 주요 기능

### 1. Django REST API

**Post API:**
- `GET /api_root/Post/` - 포스트 목록 조회
- `POST /api_root/Post/` - 새 포스트 생성
- `GET /api_root/Post/{id}/` - 포스트 상세 조회

**WellbeingLog API:**
- `GET /api_root/WellbeingLog/` - 웰빙 로그 조회
- `POST /api_root/WellbeingLog/` - 웰빙 로그 생성
- `GET /api_root/WellbeingLog/summary/` - 요약 통계

### 2. Wellbeing Analyzer

- 웹캠에서 실시간 사람 감지 (YOLOv5)
- 얼굴 감정 분석 (DeepFace)
- 활동성 측정 (움직임 추적)
- 60초마다 Django 서버로 데이터 전송

### 3. Socket Server

- 포트 9000에서 바이너리 데이터 수신
- `socket_server/request/` 폴더에 저장

---

## ⚙️ 설정 변경

### Django 서버 주소 변경

`wellbeing_analyzer.py` 파일의 21번째 줄:
```python
DJANGO_BASE_URL = "http://127.0.0.1:8000"  # 원하는 주소로 변경
```

### Wellbeing Analyzer 전송 주기 변경

`wellbeing_analyzer.py` 파일의 26번째 줄:
```python
SUMMARY_INTERVAL = 60  # 초 단위 (기본: 60초)
```

---

## 🐛 문제 해결

### 문제 1: 가상환경 활성화 오류

**증상:** `Activate.ps1` 실행 시 오류

**해결:**
```powershell
# PowerShell 실행 정책 변경
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### 문제 2: 포트 8000이 이미 사용 중

**해결:**
```bash
# 다른 포트 사용
python manage.py runserver 8001
```

### 문제 3: Wellbeing Analyzer 실행 오류

**확인 사항:**
- 웹캠 연결 확인
- `pip install deepface` 실행 확인
- 첫 실행 시 모델 다운로드 시간 필요 (인터넷 연결 필요)

### 문제 4: 이미지가 표시되지 않음

**확인 사항:**
- Django 서버가 실행 중인지 확인
- `media/` 폴더 권한 확인
- `DEBUG = True` 설정 확인 (`settings.py`)

---

## 📱 Android 앱 실행

자세한 내용은 `PhotoViewer/README.md` 참조

**요약:**
1. Android Studio 설치
2. `PhotoViewer` 폴더 열기
3. Gradle 동기화 대기
4. 에뮬레이터 또는 실제 기기 연결
5. Run 버튼 클릭

---

## 🔐 보안 주의사항

⚠️ **현재 설정은 개발용입니다!**

프로덕션 배포 전 필수 사항:
- `SECRET_KEY` 변경
- `DEBUG = False` 설정
- `ALLOWED_HOSTS` 실제 도메인만 추가
- HTTPS 설정

---

## 📞 추가 도움말

- Django 공식 문서: https://docs.djangoproject.com/
- Django REST Framework: https://www.django-rest-framework.org/
- YOLOv5: https://github.com/ultralytics/yolov5
- DeepFace: https://github.com/serengil/deepface

---

## 📸 Post API 테스트 방법

Wellbeing Analyzer가 검출한 객체를 자동으로 Post로 게시하는 기능을 테스트합니다.

### 간단 테스트 (3단계)

**1단계: Django 서버 실행**
```bash
# 터미널 1
python manage.py runserver
```

**2단계: Wellbeing Analyzer 실행**
```bash
# 터미널 2 (새 창)
python wellbeing_analyzer.py
```

**3단계: 결과 확인**
- 브라우저: `http://127.0.0.1:8000/api_root/Post/` 접속
- 콘솔: `✅ Post 게시 성공` 메시지 확인

### 동작 방식

- **새 객체 검출 시**: 즉시 Post 게시
- **주기적 게시**: 5분마다 자동 게시 (검출된 객체가 있을 때만)

### 게시되는 내용

- **제목**: 검출된 객체 목록 (예: "Detected Objects: person(1), laptop(1)")
- **내용**: 검출 시간과 객체 상세 정보
- **이미지**: 검출 결과가 표시된 웹캠 프레임

---

## ✅ 체크리스트

실행 전 확인:
- [ ] Python 3.8 이상 설치됨
- [ ] 가상환경 생성 및 활성화
- [ ] `requirements.txt` 패키지 설치 완료
- [ ] 데이터베이스 마이그레이션 완료
- [ ] Django 서버 실행 확인
- [ ] (선택) 웹캠 연결 확인 (Wellbeing Analyzer용)

---

**마지막 업데이트:** 2025년 1월

